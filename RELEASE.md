# Release Process

This document describes how to create a new release of AppLocker.

## Automated Release (Recommended)

The easiest way to release is using GitHub Actions:

1. **Commit and push your changes**:

   ```bash
   git add -A
   git commit -m "Prepare release 3.1"
   git push origin main
   ```

2. **Create and push a tag** (the version is derived from the tag):

   ```bash
   git tag -a v3.1 -m "Release v3.1"
   git push origin v3.1
   ```

3. **GitHub Actions will automatically**:
   - Build the release binary
   - Create a DMG installer
   - Create a GitHub Release with the DMG attached
   - Generate release notes

## Manual Release

If you prefer to build locally:

### Prerequisites

- macOS 13.0+ (Ventura)
- Xcode 15.0+ or Swift 5.9+
- Code signing certificate (optional for ad-hoc signing)

### Build Steps

1. **Clone and build**:

   ```bash
   cd ~/AppLocker
   make release
   ```

2. **Or use the script directly**:

   ```bash
   ./scripts/build-release.sh
   ```

3. **Find the release artifacts** in `release/`:
   - `AppLocker.app` - The signed app bundle
   - `AppLocker-X.X.dmg` - The DMG installer

4. **Create GitHub Release** (optional):
   ```bash
   gh release create v3.1 \
     release/AppLocker-3.1.dmg \
     --title "AppLocker v3.1" \
     --notes "Release notes here"
   ```

## Version Numbering

We follow [Semantic Versioning](https://semver.org/):

- **MAJOR** - Breaking changes (e.g., 3.0.0 → 4.0.0)
- **MINOR** - New features, backwards compatible (e.g., 3.0.0 → 3.1.0)
- **PATCH** - Bug fixes (e.g., 3.0.0 → 3.0.1)

Current version: Derived from git tag (e.g., `v3.1` → version `3.1`)

## Code Signing

### For Development (Ad-hoc)

```bash
codesign --force --deep --sign - --options runtime AppLocker.app
```

### For Distribution (Recommended)

Requires Apple Developer account:

```bash
# Using Developer ID for distribution outside Mac App Store
codesign --force --deep --sign "Developer ID Application: Your Name" \
  --entitlements dist/entitlements.plist \
  --options runtime \
  AppLocker.app

# Notarize (required for Gatekeeper)
xcrun notarytool submit AppLocker-X.X.dmg \
  --keychain-profile "AC_PASSWORD" \
  --wait
```

## Distribution Checklist

Before releasing:

- [ ] Version tag created (e.g., `v3.1`)
- [ ] `CHANGELOG.md` updated with changes
- [ ] README updated if needed
- [ ] All features tested on clean macOS install
- [ ] Accessibility permissions tested
- [ ] Code signed (ad-hoc minimum, Developer ID recommended)
- [ ] DMG created and tested
- [ ] Git tag created with `v` prefix (e.g., `v3.1`)
- [ ] GitHub Release created with artifacts
- [ ] Release notes written

## Troubleshooting

### Build Fails

```bash
# Clean and rebuild
make clean
make release
```

### Code Signing Issues

```bash
# Reset signatures
codesign --remove-signature AppLocker.app
codesign --force --deep --sign - AppLocker.app

# Verify
codesign --verify --deep --strict AppLocker.app
codesign -dvvv AppLocker.app
```

### DMG Creation Fails

```bash
# Manual DMG creation
hdiutil create -volname "AppLocker" \
  -srcfolder AppLocker.app \
  -ov -format UDZO \
  AppLocker.dmg
```

## Release Assets

Each release should include:

1. **AppLocker-X.X.dmg** - Main distribution file
2. **Source code** (zip and tar.gz) - Auto-generated by GitHub
3. **Release notes** - List of changes

## Security Considerations

- Never commit signing certificates or private keys
- Use GitHub Secrets for sensitive data in Actions
- Test the signed app on a fresh macOS install before release
- Consider submitting to Apple for notarization for wide distribution
